<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="react-native-code-push 热更新配置"><meta name="keywords" content="热更新"><meta name="author" content="Sir_Liu"><meta name="copyright" content="Sir_Liu"><title>react-native-code-push 热更新配置 | Coding Your Life</title><link rel="shortcut icon" href="/vite.svg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4583227810964573" crossorigin="anonymous"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '3.9.0'
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#react-native-热更新需要用到的工具"><span class="toc-number">1.</span> <span class="toc-text">react-native 热更新需要用到的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装方法"><span class="toc-number">2.</span> <span class="toc-text">安装方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#code-push-server"><span class="toc-number">2.1.</span> <span class="toc-text">code-push-server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#react-native-code-push"><span class="toc-number">2.2.</span> <span class="toc-text">react-native-code-push</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Android"><span class="toc-number">2.3.</span> <span class="toc-text">Android</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#配置Android端的Deployment-Key"><span class="toc-number">2.3.1.</span> <span class="toc-text">配置Android端的Deployment Key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改build-gradle中的配置，以便打不同测试类型的包"><span class="toc-number">2.3.2.</span> <span class="toc-text">修改build.gradle中的配置，以便打不同测试类型的包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在MainApplication中修改如下代码"><span class="toc-number">2.3.3.</span> <span class="toc-text">在MainApplication中修改如下代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IOS"><span class="toc-number">2.4.</span> <span class="toc-text">IOS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#添加灰度测试版本staging"><span class="toc-number">2.4.1.</span> <span class="toc-text">添加灰度测试版本staging</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#给项目名称添加后缀"><span class="toc-number">2.4.2.</span> <span class="toc-text">给项目名称添加后缀</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在react-native端配置更新的应用时机"><span class="toc-number">3.</span> <span class="toc-text">在react-native端配置更新的应用时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#补充"><span class="toc-number">4.</span> <span class="toc-text">补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-react-native-code-push热更新与app版本的关系"><span class="toc-number">4.1.</span> <span class="toc-text">1.react-native-code-push热更新与app版本的关系</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/16d2a30b4d8e2a895e6~tplv-t2oaga2asx-jj-mark:72:72:0:0:q75.avis"></div><div class="author-info__name text-center">Sir_Liu</div><div class="author-info__description text-center">无论从事什么行业，只要做好两件事就够了，一个是你的专业、一个是你的人品，专业决定了你的存在，人品决定了你的人脉，剩下的就是坚持，用善良專業和真诚赢取更多的信任。（No matter what industry you are in, it is enough to do two things well, one is your profession and the other is your character. Your profession determines your existence, and your character determines your network. The rest is persistence, and you should win more trust with kindness, professionalism and sincerity.）</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">11</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(chrome-extension://pkfjcehoipcdbiilobhcblbkmelocaka/start/skin/images/bg-51.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Coding Your Life</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">react-native-code-push 热更新配置</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-12</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/code-push-热更新构建说明/">code-push 热更新构建说明</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2k</span><span class="post-meta__separator">|</span><span>阅读时长: 8 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote>
<p>公司主打的一款新项目，为了满足快速迭代的需要，使用rn进行开发，项目中使用到了微软的code-push热更新功能，在这里记录一下热更新的集成过程，以及注意点。</p>
</blockquote>
<h3 id="react-native-热更新需要用到的工具"><a href="#react-native-热更新需要用到的工具" class="headerlink" title="react-native 热更新需要用到的工具"></a>react-native 热更新需要用到的工具</h3><ul>
<li><p>mysql,node </p>
</li>
<li><p><a href="https://github.com/gofugui/react-native-code-push" target="_blank" rel="noopener">react-native-code-push</a></p>
</li>
<li><p><a href="https://github.com/gofugui/code-push-server" target="_blank" rel="noopener">code-push-server</a></p>
</li>
</ul>
<h3 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h3><h4 id="code-push-server"><a href="#code-push-server" class="headerlink" title="code-push-server"></a>code-push-server</h4><ul>
<li>步骤一</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装code-push-server</span></span><br><span class="line">npm install -g code-push-server</span><br><span class="line"><span class="comment">#进入到code-push-server目录，</span></span><br><span class="line"><span class="built_in">cd</span> &lt;YOUR_DIR&gt;/code-push-server/config</span><br><span class="line"><span class="comment">#打开config/config.js文件</span></span><br><span class="line">vi config.js</span><br><span class="line"><span class="comment">#配置数据库(以下是默认的，数据库的用户名、密码、地址还有端口需要修改成你自己的)</span></span><br><span class="line"> db: &#123;</span><br><span class="line">    username: process.env.RDS_USERNAME || <span class="string">"root"</span>,</span><br><span class="line">    password: process.env.RDS_PASSWORD || null,</span><br><span class="line">    database: process.env.DATA_BASE || <span class="string">"codepush"</span>,</span><br><span class="line">    host: process.env.RDS_HOST || <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    port: process.env.RDS_PORT || 3306,</span><br><span class="line">    dialect: <span class="string">"mysql"</span>,</span><br><span class="line">    logging: <span class="literal">false</span>,</span><br><span class="line">    operatorsAliases: <span class="literal">false</span>,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置下载文件的存储地址，你可以选择一些云oss存储服务</span></span><br><span class="line"><span class="comment">#此处我们将数据存储在服务器本地</span></span><br><span class="line"><span class="comment">#配置storageDir为你的电脑上的目录</span></span><br><span class="line"><span class="comment">#配置downloadUrl为你的服务器的下载地址</span></span><br><span class="line"><span class="built_in">local</span>: &#123;</span><br><span class="line">    <span class="comment"># Binary files storage dir, Do not use tmpdir and it's public download dir.</span></span><br><span class="line">    storageDir: process.env.STORAGE_DIR || <span class="string">"/Users/tablee/workspaces/storage"</span>,</span><br><span class="line">    <span class="comment"># Binary files download host address which Code Push Server listen to. the files storage in storageDir.</span></span><br><span class="line">    downloadUrl: process.env.LOCAL_DOWNLOAD_URL || <span class="string">"http://127.0.0.1:3000/download"</span>,</span><br><span class="line">    <span class="comment"># public static download spacename.</span></span><br><span class="line">    public: <span class="string">'/download'</span></span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">#配置增量文件的存储地址</span></span><br><span class="line"><span class="comment">#修改dataDir为你的本地路径</span></span><br><span class="line">common: &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># data dir for caclulate diff files. it's optimization.</span></span><br><span class="line">    dataDir: process.env.DATA_DIR || os.tmpdir(),</span><br><span class="line">    <span class="comment"># storageType which is your binary package files store. options value is ("local" | "qiniu" | "s3"| "oss" || "tencentcloud")</span></span><br><span class="line">    storageType: process.env.STORAGE_TYPE || <span class="string">"local"</span>,</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<ul>
<li>步骤二<blockquote>
<p>安装CodePush CLI，用以和code-push-server服务进行交互,相关的code-push指令可以查看我之前的文章<a href="https://gofugui.github.io/2019/03/07/code-push-command">code-push-command</a></p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装CodePush CLI</span></span><br><span class="line">npm install -g code-push-cli</span><br></pre></td></tr></table></figure>
<h4 id="react-native-code-push"><a href="#react-native-code-push" class="headerlink" title="react-native-code-push"></a>react-native-code-push</h4><blockquote>
<p>到这一步时首先确保你已经将你的app添加进了<code>code-push-server</code>，如果还没有，请查看<a href="https://gofugui.github.io/2019/03/07/code-push-command">code-push-command</a>里的讲解，添加app到<code>code-push-server</code>，并获取<code>Deployment Key</code></p>
</blockquote>
<ul>
<li>步骤一</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装依赖</span></span><br><span class="line">npm install --save react-native-code-push</span><br><span class="line"><span class="comment">#链接原生库</span></span><br><span class="line">react-native link react-native-code-push</span><br></pre></td></tr></table></figure>
<ul>
<li>步骤二</li>
</ul>
<blockquote>
<p>在完成<a href="#步骤一">步骤一</a>的操作后，会自动在Android和iOS的源码中插入一些代码，引用这个库，但是我们还需要在这个基础上做一些个性化的配置。下面介绍一下针对不同平台的配置方法。</p>
</blockquote>
<h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><h5 id="配置Android端的Deployment-Key"><a href="#配置Android端的Deployment-Key" class="headerlink" title="配置Android端的Deployment Key"></a>配置Android端的Deployment Key</h5><blockquote>
<p>为以后维护方便，我们将key值存放在Android目录下<code>gradle.properties</code>中：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># When configured, Gradle will run in incubating parallel mode.</span></span><br><span class="line"><span class="comment"># This option should only be used with decoupled projects. More details, visit</span></span><br><span class="line"><span class="comment"># http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects</span></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">RELEASE_STAGING=&lt;YOUR_RELEASE_STAGING_KEY&gt;</span><br><span class="line">RELEASE = &lt;YOUR_RELEASE_KEY&gt;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h5 id="修改build-gradle中的配置，以便打不同测试类型的包"><a href="#修改build-gradle中的配置，以便打不同测试类型的包" class="headerlink" title="修改build.gradle中的配置，以便打不同测试类型的包"></a>修改build.gradle中的配置，以便打不同测试类型的包</h5><blockquote>
<p>为了在测试机上同时安装测试版和预发布版的app包，我们需要在<code>Android/app/build.gradle</code>中配置对应包的applicationId后缀，在buildTypes下修改如下：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    <span class="comment"># 开发版的包 没有配置热更新，所以CODEPUSH_KEY的值为空</span></span><br><span class="line">    <span class="comment"># 打包方法 react-native run-android --variant=debug --appIdSuffix=debug</span></span><br><span class="line">    debug &#123;</span><br><span class="line"></span><br><span class="line">        buildConfigField <span class="string">"String"</span>, <span class="string">"CODEPUSH_KEY"</span>, <span class="string">'""'</span></span><br><span class="line">        minifyEnabled enableProguardInReleaseBuilds</span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">"proguard-android.txt"</span>), <span class="string">"proguard-rules.pro"</span></span><br><span class="line">        applicationIdSuffix <span class="string">".debug"</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 灰度测试版本的包 CODEPUSH_KEY为我们之前在gradle.properties中的 RELEASE_STAGING 值</span></span><br><span class="line">    <span class="comment"># 打包方法 react-native run-android --variant=staging --appIdSuffix=staging</span></span><br><span class="line">    staging &#123;</span><br><span class="line"></span><br><span class="line">        matchingFallbacks = [<span class="string">'release'</span>, <span class="string">'debug'</span>]</span><br><span class="line">        buildConfigField <span class="string">"String"</span>, <span class="string">"CODEPUSH_KEY"</span>, RELEASE_STAGING</span><br><span class="line">        applicationIdSuffix <span class="string">".staging"</span></span><br><span class="line">        signingConfig signingConfigs.release</span><br><span class="line">        minifyEnabled enableProguardInReleaseBuilds</span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">"proguard-android.txt"</span>), <span class="string">"proguard-rules.pro"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#正式版的包 CODEPUSH_KEY为我们之前在gradle.properties中的 RELEASE 值</span></span><br><span class="line">    release &#123;</span><br><span class="line">        </span><br><span class="line">        debuggable <span class="literal">false</span> // 是否debug</span><br><span class="line">        aaptOptions.cruncherEnabled = <span class="literal">false</span> // 禁止Gradle检查PNG的合法性</span><br><span class="line">        buildConfigField <span class="string">"String"</span>, <span class="string">"CODEPUSH_KEY"</span>, RELEASE</span><br><span class="line">        signingConfig signingConfigs.release</span><br><span class="line">        minifyEnabled enableProguardInReleaseBuilds</span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">"proguard-android.txt"</span>), <span class="string">"proguard-rules.pro"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="在MainApplication中修改如下代码"><a href="#在MainApplication中修改如下代码" class="headerlink" title="在MainApplication中修改如下代码"></a>在<code>MainApplication</code>中修改如下代码</h5><blockquote>
<p><code>YOUR_SERVER_URL</code>为热更新服务器的地址，通过改地址可以访问到你的code-push-server服务</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new CodePush(BuildConfig.CODEPUSH_KEY, getApplicationContext(), BuildConfig.DEBUG,&lt;YOUR_SERVER_URL&gt;),</span><br></pre></td></tr></table></figure>
<h4 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h4><blockquote>
<p>与在android上的配置相似，我们同样要给iOS配置三个版本的包名：<code>debug、staging(beta)、release</code>。项目初始化时已经存在<code>debug</code>和<code>release</code>版本，所以我们只需要添加<code>staging</code>类型</p>
</blockquote>
<h5 id="添加灰度测试版本staging"><a href="#添加灰度测试版本staging" class="headerlink" title="添加灰度测试版本staging"></a>添加灰度测试版本staging</h5><ol>
<li>在项目的<code>PROJECT-Info</code>的<code>Configurations</code>里面点击<code>+</code>选择<code>Duplicate &quot;Release&quot; Configuration</code>, 并且给一个名字，我这里给了个Staging，如图：</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2419788-5d1006e95d983101.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt="添加staging"></p>
<ol start="2">
<li><p>在<code>PROJECT-Build setting-Per-configuration Build Products path-Staging</code>里面改成<code>$(BUILD_DIR)/Release$(EFFECTIVE_PLATFORM_NAME)</code></p>
</li>
<li><p>然后在项目的<code>PROJECT-Build Setting</code>里面点击<code>+</code>选择<code>Add User-Defined Setting</code>，创建好之后起个名字，这里叫<code>CODEPUSH_KEY</code>, 然后在<code>Release</code>和<code>Staging</code>里面分别写上code-push-server中添加的项目后生成的Production和Staging对应的key值,如图：</p>
</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2419788-a165590ecb7d474f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt="添加key值"></p>
<h5 id="给项目名称添加后缀"><a href="#给项目名称添加后缀" class="headerlink" title="给项目名称添加后缀"></a>给项目名称添加后缀</h5><blockquote>
<p>为了使项目在打包后方便区分打包的类型，我们可以在项目名称后面加上对应的后缀：</p>
</blockquote>
<ol>
<li>然后在项目的<code>PROJECT-Build Setting</code>里面点击<code>+</code>选择<code>Add User-Defined Setting</code>，创建好之后起个名字，这里叫<code>BUNDLE_DISPLAY_NAME_SUFFIX</code>, 然后在<code>Debug</code>后面写上<code>-Debug</code>,在<code>Staging</code>后面写上<code>-Beta</code>,如图：</li>
</ol>
<p><img src="https://github.com/gofugui/hexo/blob/master/source/images/4B1D1B79-8D21-48E2-BFEF-254EC365BED6.png?raw=true" alt="后缀"></p>
<ol start="2">
<li>在Info.plist里面加上刚才配置好的后缀，如图：</li>
</ol>
<p><img src="https://github.com/gofugui/hexo/blob/master/source/images/32B48110-9016-48AC-9598-14FF3FAB6E6A.png?raw=true" alt="Info.plist配置"></p>
<h3 id="在react-native端配置更新的应用时机"><a href="#在react-native端配置更新的应用时机" class="headerlink" title="在react-native端配置更新的应用时机"></a>在react-native端配置更新的应用时机</h3><ul>
<li>Silent sync on app start (the simplest, default behavior)</li>
</ul>
<blockquote>
<p>这种方式会自动从服务器下载可用的更新，并且在应用下次启动的时候应用更新，整个过程用户是无感知的。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fully silent update which keeps the app in</span></span><br><span class="line"><span class="comment"># sync with the server, without ever</span></span><br><span class="line"><span class="comment"># interrupting the end user</span></span><br><span class="line">class MyApp extends Component&lt;&#123;&#125;&gt; &#123;&#125;</span><br><span class="line">MyApp = codePush(MyApp);</span><br><span class="line"><span class="built_in">export</span> default MyApp;</span><br></pre></td></tr></table></figure>
<ul>
<li>Silent sync everytime the app resumes</li>
</ul>
<blockquote>
<p>当应用进入后台时，会从服务器检测是否有可用的更新，并下载更新，当应用再次从后台被唤醒的时候应用更新</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sync for updates everytime the app resumes.</span></span><br><span class="line">class MyApp extends Component&lt;&#123;&#125;&gt; &#123;&#125;</span><br><span class="line">MyApp = codePush(&#123; checkFrequency: codePush.CheckFrequency.ON_APP_RESUME, installMode: codePush.InstallMode.ON_NEXT_RESUME &#125;)(MyApp);</span><br><span class="line"><span class="built_in">export</span> default MyApp;</span><br></pre></td></tr></table></figure>
<ul>
<li>Interactive</li>
</ul>
<blockquote>
<p>交互式更新。只有当用户进行选择检查更新并确认后才下载和立即应用更新包</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Active update, which lets the end user know</span></span><br><span class="line"><span class="comment"># about each update, and displays it to them</span></span><br><span class="line"><span class="comment"># immediately after downloading it</span></span><br><span class="line">class MyApp extends Component&lt;&#123;&#125;&gt; &#123;&#125;</span><br><span class="line">MyApp = codePush(&#123; updateDialog: <span class="literal">true</span>, installMode: codePush.InstallMode.IMMEDIATE &#125;)(MyApp);</span><br><span class="line"><span class="built_in">export</span> default MyApp;</span><br></pre></td></tr></table></figure>
<ul>
<li>Log/display progress</li>
</ul>
<blockquote>
<p>显示更新的进度，我们可以通过如下的方法</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Make use of the event hooks to keep track of</span></span><br><span class="line"><span class="comment"># the different stages of the sync process.</span></span><br><span class="line">class MyApp extends Component&lt;&#123;&#125;&gt; &#123;</span><br><span class="line">    codePushStatusDidChange(status) &#123;</span><br><span class="line">        switch(status) &#123;</span><br><span class="line">            <span class="keyword">case</span> codePush.SyncStatus.CHECKING_FOR_UPDATE:</span><br><span class="line">                console.log(<span class="string">"Checking for updates."</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> codePush.SyncStatus.DOWNLOADING_PACKAGE:</span><br><span class="line">                console.log(<span class="string">"Downloading package."</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> codePush.SyncStatus.INSTALLING_UPDATE:</span><br><span class="line">                console.log(<span class="string">"Installing update."</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> codePush.SyncStatus.UP_TO_DATE:</span><br><span class="line">                console.log(<span class="string">"Up-to-date."</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> codePush.SyncStatus.UPDATE_INSTALLED:</span><br><span class="line">                console.log(<span class="string">"Update installed."</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    codePushDownloadDidProgress(progress) &#123;</span><br><span class="line">        console.log(progress.receivedBytes + <span class="string">" of "</span> + progress.totalBytes + <span class="string">" received."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">MyApp = codePush(MyApp);</span><br><span class="line"><span class="built_in">export</span> default MyApp;</span><br></pre></td></tr></table></figure>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><h4 id="1-react-native-code-push热更新与app版本的关系"><a href="#1-react-native-code-push热更新与app版本的关系" class="headerlink" title="1.react-native-code-push热更新与app版本的关系"></a>1.react-native-code-push热更新与app版本的关系</h4><ul>
<li>android</li>
</ul>
<blockquote>
<p>android在code-push发布更新的时候，版本独立不影响的位数是<code>两位数</code>。</p>
</blockquote>
<p>  举例说明：</p>
<blockquote>
<p>  a. versionName为2.1，和versionName为2.2的两个app版本,当versionName=2.2的app发布codepush更新的时候，受影响的只有2.2 和2.2.X，X为正整数。versionName=2.1是不会收到任何影响的，所以后续就需要创建两条线路对不同的版本进行维护。</p>
</blockquote>
<blockquote>
<p>   b. 由a可以知道，versionName=2.2.1和versionName=2.2.2两个版本在获取更新上，获取的是同个版本,当versionName=2.2.2发布更新的时候，versionName=2.2.1的app同样会受到影响接受更新。</p>
</blockquote>
<blockquote>
<p>总结：从以上特性，我们主要将这个功能用在小版本更新，或者bug修复上。versionName = X.Y.Z的版本中，我们主要发布到应用市场的软件一般都是改变：X.Y的值。对于创业公司来说，要维护多个软件版本成本是非常高的，所以我们也是尽量要求用户升级到最新版本。</p>
</blockquote>
<ul>
<li>ios</li>
</ul>
<blockquote>
<p>IOS在codepush发布更新时，版本独立不影响的位数是<code>三位数</code>。即iOS版本都是独立不影响，version=X.Y.Z，当codepush发布更新时，只会影响与其X.Y.Z三位数完全相同的版本。</p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Sir_Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gofugui.github.io/2019/11/12/code-push/">https://gofugui.github.io/2019/11/12/code-push/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gofugui.github.io">Coding Your Life</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/热更新/">热更新</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/03/30/中高级前端须注意的40条移动端H5坑位指南/"><i class="fa fa-chevron-left">  </i><span>中高级前端须注意的40条移动端H5坑位指南</span></a></div><div class="next-post pull-right"><a href="/2019/11/10/Git-doc/"><span>Git 常用命令速查表</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(chrome-extension://pkfjcehoipcdbiilobhcblbkmelocaka/start/skin/images/bg-51.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2025 By Sir_Liu</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>