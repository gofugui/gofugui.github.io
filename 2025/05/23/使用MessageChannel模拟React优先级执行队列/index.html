<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ä½¿ç”¨MessageChannelæ¨¡æ‹ŸReactä¼˜å…ˆçº§æ‰§è¡Œé˜Ÿåˆ—"><meta name="keywords" content="JavaScript,ES6,React"><meta name="author" content="Sir_Liu"><meta name="copyright" content="Sir_Liu"><title>ä½¿ç”¨MessageChannelæ¨¡æ‹ŸReactä¼˜å…ˆçº§æ‰§è¡Œé˜Ÿåˆ— | Coding Your Life</title><link rel="shortcut icon" href="/vite.svg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Site Name Atom Feed"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4583227810964573" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  hexoVersion: '3.9.0'
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="åˆ‡æ¢æ–‡ç« è¯¦æƒ…">åˆ‡æ¢ç«™ç‚¹æ¦‚è§ˆ</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœ‰ç–‘é—®ğŸ¤”ï¸è¯„è®ºåŒºè§"><span class="toc-number">1.0.1.</span> <span class="toc-text">ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœ‰ç–‘é—®ğŸ¤”ï¸è¯„è®ºåŒºè§</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/16d2a30b4d8e2a895e6~tplv-t2oaga2asx-jj-mark:72:72:0:0:q75.avis"></div><div class="author-info__name text-center">Sir_Liu</div><div class="author-info__description text-center">æ— è®ºä»äº‹ä»€ä¹ˆè¡Œä¸šï¼Œåªè¦åšå¥½ä¸¤ä»¶äº‹å°±å¤Ÿäº†ï¼Œä¸€ä¸ªæ˜¯ä½ çš„ä¸“ä¸šã€ä¸€ä¸ªæ˜¯ä½ çš„äººå“ï¼Œä¸“ä¸šå†³å®šäº†ä½ çš„å­˜åœ¨ï¼Œäººå“å†³å®šäº†ä½ çš„äººè„‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯åšæŒï¼Œç”¨å–„è‰¯å°ˆæ¥­å’ŒçœŸè¯šèµ¢å–æ›´å¤šçš„ä¿¡ä»»ã€‚ï¼ˆNo matter what industry you are in, it is enough to do two things well, one is your profession and the other is your character. Your profession determines your existence, and your character determines your network. The rest is persistence, and you should win more trust with kindness, professionalism and sincerity.ï¼‰</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">æ–‡ç« </span><span class="pull-right">18</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">æ ‡ç­¾</span><span class="pull-right">17</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">åˆ†ç±»</span><span class="pull-right">10</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(chrome-extension://pkfjcehoipcdbiilobhcblbkmelocaka/start/skin/images/bg-51.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Coding Your Life</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">é¦–é¡µ</a><a class="site-page" href="/archives">å½’æ¡£</a><a class="site-page" href="/tags">æ ‡ç­¾</a><a class="site-page" href="/atom.xml">rss</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">ä½¿ç”¨MessageChannelæ¨¡æ‹ŸReactä¼˜å…ˆçº§æ‰§è¡Œé˜Ÿåˆ—</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-05-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/å‰ç«¯ES6ä¸­APIä½¿ç”¨/">å‰ç«¯ES6ä¸­APIä½¿ç”¨</a><div class="post-meta-wordcount"><span>å­—æ•°æ€»è®¡: </span><span class="word-count">516</span><span class="post-meta__separator">|</span><span>é˜…è¯»æ—¶é•¿: 2 åˆ†é’Ÿ</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><strong>MessageChannel</strong> æ˜¯ <strong>HTML5</strong> ä¸­ <strong>window</strong> å¯¹è±¡æä¾›çš„ä¸€ä¸ªç”¨äºè·¨çº¿ç¨‹é€šä¿¡çš„ APIï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸åŒçš„æµè§ˆä¸Šä¸‹æ–‡ï¼ˆå¦‚ä¸»çº¿ç¨‹ä¸ Worker çº¿ç¨‹ï¼‰ä¹‹é—´ä¼ é€’æ•°æ®ã€‚React åˆ©ç”¨äº† <strong>MessageChannel</strong> æ¥å®ç°ä¼˜å…ˆçº§ä»»åŠ¡è°ƒåº¦ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹æ˜¯å…³äº <strong>MessageChannel</strong> çš„å…³é”®ç‚¹ï¼š</p>
</blockquote>
<p><strong>MessageChannel</strong> åˆ›å»ºä¸¤ä¸ªç«¯å£ (port1, port2)ï¼Œå®ƒä»¬å¯ä»¥äº’ç›¸å‘é€æ¶ˆæ¯ã€‚<br>åœ¨ React çš„è°ƒåº¦å™¨ä¸­ï¼Œä½¿ç”¨ <strong>MessageChannel</strong> å°†ä½ä¼˜å…ˆçº§ä»»åŠ¡å»¶è¿Ÿæ‰§è¡Œï¼Œè€Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡å¯ä»¥ä¸­æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡ã€‚<br>é€šè¿‡ port.postMessage() å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œé€šè¿‡ç›‘å¬ message äº‹ä»¶æ¥è§¦å‘ä»»åŠ¡æ‰§è¡Œã€‚<br>ç›¸æ¯” <strong>setTimeout</strong>ï¼Œ<strong>MessageChannel</strong> æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚<br>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">enum ScheduleType &#123;</span><br><span class="line">  event = <span class="number">1000</span>,</span><br><span class="line">  timeout = <span class="number">2000</span>,</span><br><span class="line">&#125;</span><br><span class="line">type  ScheduleItem = &#123;</span><br><span class="line">  time: number,</span><br><span class="line">  callback: <span class="built_in">Function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleSchedule</span> </span>&#123; </span><br><span class="line">    private queue: <span class="built_in">Array</span>&lt;any&gt; = [];</span><br><span class="line">    private port1: MessagePort;</span><br><span class="line">    private port2: MessagePort;</span><br><span class="line">    private isRunning: boolean = <span class="literal">false</span>; </span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">const</span> channel = <span class="keyword">new</span> MessageChannel();</span><br><span class="line">     <span class="keyword">this</span>.port1 = channel.port1;</span><br><span class="line">     <span class="keyword">this</span>.port2 = channel.port2;</span><br><span class="line">     <span class="comment">// è¿™é‡Œå¿…é¡»è¦ç»‘å®šthis</span></span><br><span class="line">     <span class="keyword">this</span>.onSchedule = <span class="keyword">this</span>.onSchedule.bind(<span class="keyword">this</span>);</span><br><span class="line">     <span class="keyword">this</span>.port1.onmessage = <span class="keyword">this</span>.onSchedule;</span><br><span class="line">    &#125;</span><br><span class="line">    onSchedule()&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'å¼€å§‹æ‰§è¡Œäº†'</span>)</span><br><span class="line">      <span class="keyword">this</span>.queueLoop();</span><br><span class="line">    &#125;</span><br><span class="line">    dispatchMsg()&#123;</span><br><span class="line">       <span class="keyword">this</span>.port2.postMessage(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    schedule(fn: <span class="built_in">Function</span>, <span class="attr">scheduleType</span>: ScheduleType)&#123;</span><br><span class="line">      <span class="keyword">const</span> time = performance.now() + scheduleType;</span><br><span class="line">      <span class="keyword">this</span>.push(&#123;<span class="attr">callback</span>: fn, time &#125;);</span><br><span class="line">      <span class="keyword">if</span>(!<span class="keyword">this</span>.isRunning)&#123;</span><br><span class="line">        <span class="keyword">this</span>.isRunning = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.dispatchMsg();</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    push(schedule: ScheduleItem)&#123;</span><br><span class="line">      <span class="keyword">this</span>.queue.push(schedule);</span><br><span class="line">      <span class="keyword">this</span>.queue.sort(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a.time - b.time);</span><br><span class="line">    &#125;</span><br><span class="line">    pop()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.queue.shift()</span><br><span class="line">    &#125;</span><br><span class="line">   queueLoop()&#123;</span><br><span class="line">     <span class="keyword">let</span> schedule = <span class="keyword">this</span>.pop();</span><br><span class="line">     <span class="keyword">while</span>(schedule)&#123;</span><br><span class="line">         schedule.callback();</span><br><span class="line">         schedule = <span class="keyword">this</span>.pop();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">this</span>.isRunning = <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> simpleSchedule = <span class="keyword">new</span> SimpleSchedule();</span><br><span class="line"></span><br><span class="line">simpleSchedule.schedule(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'schedule 1'</span>);</span><br><span class="line">&#125;,ScheduleType.timeout);</span><br><span class="line"></span><br><span class="line">simpleSchedule.schedule(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'schedule 2'</span>);</span><br><span class="line">&#125;,ScheduleType.event);</span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"> å¼€å§‹æ‰§è¡Œäº†</span><br><span class="line"> schedule <span class="number">2</span></span><br><span class="line"> schedule <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>SimpleSchedule</code>ç±»æ˜¯ä¸€ä¸ªç®€å•çš„è°ƒåº¦å™¨ï¼Œç”¨äºç®¡ç†å¤šä¸ªä»»åŠ¡ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª<code>isRunning</code>å±æ€§æ¥æŒ‡ç¤ºå½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>tsæ–‡ä»¶å¯ä»¥ç›´æ¥ç”¨ts-nodeè¿è¡Œï¼Œå¦‚æœæŠ¥é”™<code>TypeError [ERR_UNKNOWN_FILE_EXTENSION]: Unknown file extension &quot;.ts&quot; for......</code> è¯·åœ¨ts-connfigä¸­æ·»åŠ <code>&quot;ts-node&quot;: { &quot;esm&quot;: true }</code></p>
<h3 id="ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœ‰ç–‘é—®ğŸ¤”ï¸è¯„è®ºåŒºè§"><a href="#ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœ‰ç–‘é—®ğŸ¤”ï¸è¯„è®ºåŒºè§" class="headerlink" title="ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœ‰ç–‘é—®ğŸ¤”ï¸è¯„è®ºåŒºè§"></a>ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœ‰ç–‘é—®ğŸ¤”ï¸è¯„è®ºåŒºè§</h3></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Sir_Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://gofugui.github.io/2025/05/23/ä½¿ç”¨MessageChannelæ¨¡æ‹ŸReactä¼˜å…ˆçº§æ‰§è¡Œé˜Ÿåˆ—/">https://gofugui.github.io/2025/05/23/ä½¿ç”¨MessageChannelæ¨¡æ‹ŸReactä¼˜å…ˆçº§æ‰§è¡Œé˜Ÿåˆ—/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://gofugui.github.io">Coding Your Life</a>ï¼</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a><a class="post-meta__tags" href="/tags/ES6/">ES6</a><a class="post-meta__tags" href="/tags/React/">React</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2025/05/25/canvaså®ç°ä»£ç é›¨æ•ˆæœ/"><i class="fa fa-chevron-left">  </i><span>canvaså®ç°ä»£ç é›¨æ•ˆæœ</span></a></div><div class="next-post pull-right"><a href="/2025/05/22/vue3 å’Œ react è™šæ‹Ÿdom/"><span>vue3 å’Œ react è™šæ‹Ÿdom</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'Ov23liqBpY9MxdjqDFTA',
  clientSecret: 'c824e3fe864528851e7734e9f4661a8fd108b390',
  repo: 'gofugui.github.io',
  owner: 'gofugui',
  admin: 'gofugui',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4583227810964573" data-ad-slot="8925032663" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});
</script><footer class="footer-bg" style="background-image: url(chrome-extension://pkfjcehoipcdbiilobhcblbkmelocaka/start/skin/images/bg-51.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2025 By Sir_Liu</div><div class="framework-info"><span>é©±åŠ¨ - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script> <script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>