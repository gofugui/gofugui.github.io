<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="nodejs开发npm镜像源管理工具npm-mirror-cli"><meta name="keywords" content="JavaScript,ES6,Nodejs"><meta name="author" content="Sir_Liu"><meta name="copyright" content="Sir_Liu"><title>nodejs开发npm镜像源管理工具npm-mirror-cli | Coding Your Life</title><link rel="shortcut icon" href="/vite.svg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Site Name Atom Feed"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4583227810964573" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '3.9.0'
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CLI-工具设计"><span class="toc-number">1.0.1.</span> <span class="toc-text">CLI 工具设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#功能说明"><span class="toc-number">1.0.2.</span> <span class="toc-text">功能说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方法"><span class="toc-number">1.0.3.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#源码"><span class="toc-number">1.0.4.</span> <span class="toc-text">源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现特点"><span class="toc-number">1.0.5.</span> <span class="toc-text">实现特点</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/16d2a30b4d8e2a895e6~tplv-t2oaga2asx-jj-mark:72:72:0:0:q75.avis"></div><div class="author-info__name text-center">Sir_Liu</div><div class="author-info__description text-center">无论从事什么行业，只要做好两件事就够了，一个是你的专业、一个是你的人品，专业决定了你的存在，人品决定了你的人脉，剩下的就是坚持，用善良專業和真诚赢取更多的信任。（No matter what industry you are in, it is enough to do two things well, one is your profession and the other is your character. Your profession determines your existence, and your character determines your network. The rest is persistence, and you should win more trust with kindness, professionalism and sincerity.）</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">17</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">16</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(chrome-extension://pkfjcehoipcdbiilobhcblbkmelocaka/start/skin/images/bg-51.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Coding Your Life</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/atom.xml">rss</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">nodejs开发npm镜像源管理工具npm-mirror-cli</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-05-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Nodejs/">Nodejs</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1.8k</span><span class="post-meta__separator">|</span><span>阅读时长: 8 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在使用nodejs时，对镜像源的管理往往需要手动配置，有时候需要记忆复杂而冗长的源链接，这个工具将支持常见镜像源（如官方、淘宝、华为等）的本地配置，你可以为每个镜像源设置一个简单好记的名称，还可以测试镜像源的速度，方便选择最优的镜像源，本工具同时提供了简洁易用的交互界面，方便大家日常使用。</p>
<h3 id="CLI-工具设计"><a href="#CLI-工具设计" class="headerlink" title="CLI 工具设计"></a><strong>CLI 工具设计</strong></h3><p>这个工具具备以下功能：</p>
<ul>
<li>列出可用的镜像源</li>
<li>设置特定的镜像源</li>
<li>查看当前使用的镜像源</li>
<li>删除特定的镜像源</li>
<li>添加自定义镜像源</li>
<li>测试镜像源速度</li>
<li>备份和恢复配置</li>
</ul>
<h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a><strong>功能说明</strong></h3><ol>
<li><strong>列出镜像源 (<code>list</code>)</strong>：显示所有可用的镜像源及其详细信息。</li>
<li><strong>切换镜像源 (<code>use &lt;name&gt;</code>)</strong>：快速切换到指定镜像源。</li>
<li><strong>查看当前镜像源 (<code>current</code>)</strong>：显示当前正在使用的镜像源。</li>
<li><strong>添加自定义镜像源 (<code>add &lt;name&gt; &lt;registry&gt; [home] [description]</code>)</strong>：添加自定义的 npm 镜像源。</li>
<li><strong>删除镜像源 (<code>delete &lt;name&gt;</code>)</strong>：删除已添加的自定义镜像源。</li>
<li><strong>测试镜像源速度 (<code>test</code>)</strong>：测试并比较所有镜像源的响应速度。</li>
<li><strong>交互式界面 (<code>interactive</code>)</strong>：通过友好的交互界面执行上述操作。</li>
</ol>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a><strong>使用方法</strong></h3><ol>
<li><p><strong>全局安装</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm-mirror-cli</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>基本命令示例</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有镜像源</span></span><br><span class="line">npm-mirror-cli list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到淘宝镜像</span></span><br><span class="line">npm-mirror-cli use taobao</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前镜像源</span></span><br><span class="line">npm-mirror-cli current</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加自定义镜像源</span></span><br><span class="line">npm-mirror-cli add my-mirror https://my-registry.com https://my-home.com <span class="string">"我的私有镜像"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试所有镜像源速度</span></span><br><span class="line">npm-mirror-cli <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用交互式界面</span></span><br><span class="line">npm-mirror-cli interactive</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a><strong>源码</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">'commander'</span>;</span><br><span class="line"><span class="keyword">import</span> inquirer <span class="keyword">from</span> <span class="string">'inquirer'</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'node:fs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; execSync &#125; <span class="keyword">from</span> <span class="string">'node:child_process'</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">'node:path'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> ora <span class="keyword">from</span> <span class="string">'ora'</span>;</span><br><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">'chalk'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; existsSync, readFileSync, writeFileSync &#125; = fs;</span><br><span class="line"><span class="keyword">const</span> &#123; join &#125; = path;</span><br><span class="line"><span class="comment">// 配置文件路径</span></span><br><span class="line"><span class="keyword">const</span> CONFIG_PATH = join(process.env.HOME || process.env.USERPROFILE, <span class="string">'.npm-mirror.json'</span>);</span><br><span class="line"><span class="comment">// 默认镜像源列表</span></span><br><span class="line"><span class="keyword">const</span> DEFAULT_MIRRORS = &#123;</span><br><span class="line">    npm: &#123;</span><br><span class="line">        registry: <span class="string">'https://registry.npmjs.org'</span>,</span><br><span class="line">        home: <span class="string">'https://www.npmjs.com'</span>,</span><br><span class="line">        description: <span class="string">'官方 NPM 镜像'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    taobao: &#123;</span><br><span class="line">        registry: <span class="string">'https://registry.npmmirror.com'</span>,</span><br><span class="line">        home: <span class="string">'https://npmmirror.com'</span>,</span><br><span class="line">        description: <span class="string">'淘宝 NPM 镜像，国内推荐'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    huawei: &#123;</span><br><span class="line">        registry: <span class="string">'https://mirrors.huaweicloud.com/repository/npm/'</span>,</span><br><span class="line">        home: <span class="string">'https://developer.huawei.com'</span>,</span><br><span class="line">        description: <span class="string">'华为 NPM 镜像'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    cnpm: &#123;</span><br><span class="line">        registry: <span class="string">'https://r.cnpmjs.org'</span>,</span><br><span class="line">        home: <span class="string">'https://cnpmjs.org'</span>,</span><br><span class="line">        description: <span class="string">'cnpm 镜像'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取配置文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readConfig</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (existsSync(CONFIG_PATH)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(readFileSync(CONFIG_PATH, <span class="string">'utf8'</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(chalk.red(<span class="string">'配置文件解析失败，将使用默认配置'</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">current</span>: <span class="string">'npm'</span>, <span class="attr">mirrors</span>: DEFAULT_MIRRORS &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存配置文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveConfig</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    writeFileSync(CONFIG_PATH, <span class="built_in">JSON</span>.stringify(config, <span class="literal">null</span>, <span class="number">2</span>), <span class="string">'utf8'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前镜像源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentMirror</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> config.mirrors[config.current] || config.mirrors.npm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置镜像源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setMirror</span>(<span class="params">name, config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!config.mirrors[name]) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(chalk.red(<span class="string">`镜像源 <span class="subst">$&#123;name&#125;</span> 不存在`</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        execSync(<span class="string">`npm config set registry <span class="subst">$&#123;config.mirrors[name].registry&#125;</span>`</span>);</span><br><span class="line">        config.current = name;</span><br><span class="line">        saveConfig(config);</span><br><span class="line">        <span class="built_in">console</span>.log(chalk.green(<span class="string">`✅ 已成功将镜像源设置为 <span class="subst">$&#123;name&#125;</span>`</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(chalk.red(<span class="string">`设置镜像源失败: <span class="subst">$&#123;error.message&#125;</span>`</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> config = readConfig();</span><br><span class="line"><span class="comment">// 测试镜像源速度</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testMirrorSpeed</span>(<span class="params">registry</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> testUrl = <span class="string">`<span class="subst">$&#123;registry&#125;</span>/react/latest`</span>;</span><br><span class="line">    <span class="keyword">const</span> spinner = ora(<span class="string">`正在测试 <span class="subst">$&#123;registry&#125;</span> 速度...`</span>).start();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">        <span class="keyword">await</span> axios.head(testUrl, &#123; <span class="attr">timeout</span>: <span class="number">5000</span> &#125;);</span><br><span class="line">        <span class="keyword">const</span> end = <span class="built_in">Date</span>.now();</span><br><span class="line">        <span class="keyword">const</span> time = end - start;</span><br><span class="line">        spinner.succeed(<span class="string">`测试完成: <span class="subst">$&#123;registry&#125;</span> - <span class="subst">$&#123;time&#125;</span>ms`</span>);</span><br><span class="line">        <span class="keyword">return</span> time;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        spinner.fail(<span class="string">`测试失败: <span class="subst">$&#123;registry&#125;</span> - <span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">Infinity</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列出所有镜像源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listMirrors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.bold(<span class="string">'\n可用镜像源列表:\n'</span>));</span><br><span class="line">    <span class="built_in">Object</span>.entries(config.mirrors).forEach(<span class="function">(<span class="params">[name, mirror]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isCurrent = name === config.current;</span><br><span class="line">        <span class="keyword">const</span> prefix = isCurrent ? chalk.green(<span class="string">'* '</span>) : <span class="string">'  '</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;prefix&#125;</span><span class="subst">$&#123;chalk.cyan(name)&#125;</span> - <span class="subst">$&#123;mirror.description&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`  <span class="subst">$&#123;chalk.gray(<span class="string">'registry:'</span>)&#125;</span> <span class="subst">$&#123;mirror.registry&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`  <span class="subst">$&#123;chalk.gray(<span class="string">'home:'</span>)&#125;</span> <span class="subst">$&#123;mirror.home&#125;</span>\n`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看当前使用的镜像源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showCurrentMirror</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> current = getCurrentMirror(config);</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.cyan(<span class="string">`当前使用的镜像源: <span class="subst">$&#123;config.current&#125;</span>`</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.gray(<span class="string">`registry: <span class="subst">$&#123;current.registry&#125;</span>`</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.gray(<span class="string">`home: <span class="subst">$&#123;current.home&#125;</span>`</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加自定义镜像源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addCustomMirror</span>(<span class="params">name, registry, home = <span class="string">'无'</span>, description = <span class="string">'自定义镜像源'</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!name || !registry) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(chalk.red(<span class="string">'请输入正确的镜像源信息'</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (config.mirrors[name]) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(chalk.red(<span class="string">`镜像源 <span class="subst">$&#123;name&#125;</span> 已存在`</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    config.mirrors[name] = &#123; registry, home, description &#125;;</span><br><span class="line">    saveConfig(config);</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.green(<span class="string">`✅ 已添加镜像源 <span class="subst">$&#123;name&#125;</span>`</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试镜像源速度</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testMirror</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.bold(<span class="string">'\n正在测试所有镜像源速度...\n'</span>));</span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [name, mirror] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(config.mirrors)) &#123;</span><br><span class="line">        <span class="keyword">const</span> time = <span class="keyword">await</span> testMirrorSpeed(mirror.registry);</span><br><span class="line">        results.push(&#123; name, time &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(chalk.bold(<span class="string">'\n测试结果（按速度排序）:\n'</span>));</span><br><span class="line">    results.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.time - b.time).forEach(<span class="function">(<span class="params">&#123; name, time &#125;, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isCurrent = name === config.current;</span><br><span class="line">        <span class="keyword">const</span> prefix = isCurrent ? chalk.green(<span class="string">'* '</span>) : <span class="string">'  '</span>;</span><br><span class="line">        <span class="keyword">const</span> timeStr = time === <span class="literal">Infinity</span> ? <span class="string">'超时'</span> : <span class="string">`<span class="subst">$&#123;time&#125;</span>ms`</span>;</span><br><span class="line">        <span class="keyword">const</span> rank = index + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;prefix&#125;</span><span class="subst">$&#123;rank&#125;</span>. <span class="subst">$&#123;chalk.cyan(name)&#125;</span> - <span class="subst">$&#123;timeStr&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 主程序</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    program</span><br><span class="line">        .version(<span class="string">'1.0.0'</span>)</span><br><span class="line">        .description(<span class="string">'NPM 镜像源管理工具'</span>);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'list'</span>)</span><br><span class="line">        .description(<span class="string">'列出所有可用镜像源'</span>)</span><br><span class="line">        .action(listMirrors);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'use &lt;name&gt;'</span>)</span><br><span class="line">        .description(<span class="string">'切换到指定镜像源'</span>)</span><br><span class="line">        .action(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">            setMirror(name, config);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'current'</span>)</span><br><span class="line">        .description(<span class="string">'查看当前使用的镜像源'</span>)</span><br><span class="line">        .action(showCurrentMirror);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'add &lt;name&gt; &lt;registry&gt; [home] [description]'</span>)</span><br><span class="line">        .description(<span class="string">'添加自定义镜像源'</span>)</span><br><span class="line">        .action(addCustomMirror);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'delete &lt;name&gt;'</span>)</span><br><span class="line">        .description(<span class="string">'删除镜像源'</span>)</span><br><span class="line">        .action(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (name === <span class="string">'npm'</span> || name === <span class="string">'taobao'</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(chalk.red(<span class="string">'不能删除内置镜像源'</span>));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!config.mirrors[name]) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(chalk.red(<span class="string">`镜像源 <span class="subst">$&#123;name&#125;</span> 不存在`</span>));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (config.current === name) &#123;</span><br><span class="line">                config.current = <span class="string">'npm'</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">delete</span> config.mirrors[name];</span><br><span class="line">            saveConfig(config);</span><br><span class="line">            <span class="built_in">console</span>.log(chalk.green(<span class="string">`✅ 已删除镜像源 <span class="subst">$&#123;name&#125;</span>`</span>));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'test'</span>)</span><br><span class="line">        .description(<span class="string">'测试所有镜像源速度'</span>)</span><br><span class="line">        .action(testMirror);</span><br><span class="line"></span><br><span class="line">    program</span><br><span class="line">        .command(<span class="string">'interactive'</span>)</span><br><span class="line">        .description(<span class="string">'交互式界面'</span>)</span><br><span class="line">        .action(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; action &#125; = <span class="keyword">await</span> inquirer.prompt([&#123;</span><br><span class="line">                type: <span class="string">'list'</span>,</span><br><span class="line">                name: <span class="string">'action'</span>,</span><br><span class="line">                message: <span class="string">'请选择操作:'</span>,</span><br><span class="line">                choices: [</span><br><span class="line">                    <span class="string">'查看当前镜像源'</span>,</span><br><span class="line">                    <span class="string">'列出所有镜像源'</span>,</span><br><span class="line">                    <span class="string">'切换镜像源'</span>,</span><br><span class="line">                    <span class="string">'添加自定义镜像源'</span>,</span><br><span class="line">                    <span class="string">'测试镜像源速度'</span>,</span><br><span class="line">                    <span class="string">'退出'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'查看当前镜像源'</span>:</span><br><span class="line">                    showCurrentMirror();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'列出所有镜像源'</span>:</span><br><span class="line">                    listMirrors();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'切换镜像源'</span>:</span><br><span class="line">                    <span class="keyword">const</span> &#123; mirror &#125; = <span class="keyword">await</span> inquirer.prompt([&#123;</span><br><span class="line">                        type: <span class="string">'list'</span>,</span><br><span class="line">                        name: <span class="string">'mirror'</span>,</span><br><span class="line">                        message: <span class="string">'选择要使用的镜像源:'</span>,</span><br><span class="line">                        choices: <span class="built_in">Object</span>.keys(config.mirrors)</span><br><span class="line">                    &#125;]);</span><br><span class="line">                    setMirror(mirror, config);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'添加自定义镜像源'</span>:</span><br><span class="line">                    <span class="keyword">const</span> answers = <span class="keyword">await</span> inquirer.prompt([</span><br><span class="line">                        &#123; <span class="attr">type</span>: <span class="string">'input'</span>, <span class="attr">name</span>: <span class="string">'name'</span>, <span class="attr">message</span>: <span class="string">'镜像源名称:'</span> &#125;,</span><br><span class="line">                        &#123; <span class="attr">type</span>: <span class="string">'input'</span>, <span class="attr">name</span>: <span class="string">'registry'</span>, <span class="attr">message</span>: <span class="string">'registry 地址:'</span> &#125;,</span><br><span class="line">                        &#123; <span class="attr">type</span>: <span class="string">'input'</span>, <span class="attr">name</span>: <span class="string">'home'</span>, <span class="attr">message</span>: <span class="string">'主页地址:'</span> &#125;,</span><br><span class="line">                        &#123; <span class="attr">type</span>: <span class="string">'input'</span>, <span class="attr">name</span>: <span class="string">'description'</span>, <span class="attr">message</span>: <span class="string">'描述信息:'</span> &#125;</span><br><span class="line">                    ]);</span><br><span class="line">                    addCustomMirror(answers.name, answers.registry, answers.home, answers.description);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'测试镜像源速度'</span>:</span><br><span class="line">                    testMirror();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'退出'</span>:</span><br><span class="line">                    <span class="built_in">console</span>.log(chalk.yellow(<span class="string">'👋 再见!'</span>));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果没有参数，显示帮助信息</span></span><br><span class="line">    <span class="keyword">if</span> (process.argv.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        program.help();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        program.parse(process.argv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br></pre></td></tr></table></figure>
<h3 id="实现特点"><a href="#实现特点" class="headerlink" title="实现特点"></a><strong>实现特点</strong></h3><ul>
<li><strong>配置文件</strong>：将镜像源信息保存在用户主目录下的 <code>.npm-mirror.json</code> 文件中。</li>
<li><strong>用户友好</strong>：使用颜色和图标增强视觉效果，提供清晰的操作反馈。</li>
<li><strong>速度测试</strong>：通过 HTTP 请求测试镜像源响应速度，帮助选择最优源。</li>
<li><strong>交互式界面</strong>：提供直观的菜单驱动操作，降低使用门槛。</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Sir_Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gofugui.github.io/2025/05/28/开发npm镜像源管理工具npm-mirror-cli/">https://gofugui.github.io/2025/05/28/开发npm镜像源管理工具npm-mirror-cli/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gofugui.github.io">Coding Your Life</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a><a class="post-meta__tags" href="/tags/ES6/">ES6</a><a class="post-meta__tags" href="/tags/Nodejs/">Nodejs</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2025/05/27/最长递增子序列算法/"><span>最长递增子序列算法</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'Ov23liqBpY9MxdjqDFTA',
  clientSecret: 'c824e3fe864528851e7734e9f4661a8fd108b390',
  repo: 'gofugui.github.io',
  owner: 'gofugui',
  admin: 'gofugui',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4583227810964573" data-ad-slot="8925032663" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});
</script><footer class="footer-bg" style="background-image: url(chrome-extension://pkfjcehoipcdbiilobhcblbkmelocaka/start/skin/images/bg-51.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2025 By Sir_Liu</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script> <script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>