(this.webpackJsonpwebrtc=this.webpackJsonpwebrtc||[]).push([[0],{104:function(e,t,r){},105:function(e,t,r){},146:function(e,t,r){},148:function(e,t,r){},149:function(e,t,r){"use strict";r.r(t);var i=r(0),n=r.n(i),s=r(23),c=r.n(s),o=(r(104),r(105),r(2)),a=(r(146),r(1));const l=10,d=3e3/l;function u({stream:e}){const[t,r]=Object(i.useState)({isStart:!1,isPause:!1}),n=Object(i.useRef)(0);const s=Object(i.useRef)(new MediaRecorder(e,{mimeType:"video/x-matroska"})),c=Object(i.useRef)([]),u=()=>{var r;console.time();var i=()=>{let r;if(console.log("\u6b63\u5728\u5f55\u5236\u3002\u3002\u3002"),t.isStart&&(null===c||void 0===c?void 0:c.current.length)>=1)return;if((null===c||void 0===c?void 0:c.current.length)>=5){var i;const e=null===c||void 0===c?void 0:c.current.shift();r=null===e||void 0===e?void 0:e.recorder,null===(i=r)||void 0===i||i.requestData(),e&&(e.chunks=[])}else r=new MediaRecorder(e,{mimeType:"video/x-matroska"}),r.start();if(!r)return;const n=[];r.ondataavailable=e=>{n.push(e.data)},r.onstop=e=>{},null===c||void 0===c||c.current.push({recorder:r,chunks:n})};null===s||void 0===s||null===(r=s.current)||void 0===r||r.start(l),s.current.onstop=e=>{},s.current.ondataavailable=e=>{n.current++,n.current<d&&(i(),n.current=n.current+d),n.current%d===0&&i()}},v=()=>{var e;console.log("\u7ed3\u675f\u5f55\u5236\u3002\u3002\u3002"),console.timeEnd(),null===c||void 0===c||c.current.forEach((e=>{var t;(null===e||void 0===e?void 0:e.recorder)&&(null===e||void 0===e||null===(t=e.recorder)||void 0===t||t.stop())})),null===s||void 0===s||null===(e=s.current)||void 0===e||e.stop(),r((e=>({...e,isStart:!1}))),setTimeout((()=>{(()=>{var e,t;const r=null===c||void 0===c||null===(e=c.current)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.chunks;if(r){var i=new Blob(r,{type:"video/x-matroska"}),n=URL.createObjectURL(i),s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=n,s.download="video.mp4",s.click(),window.URL.revokeObjectURL(n)}else console.log("no data...")})(),h()}),1e3)},h=()=>{c.current=[],n.current=0,u()};return Object(i.useEffect)((()=>{u()}),[]),Object(a.jsx)("div",{children:Object(a.jsxs)("div",{className:"footer",children:[null!==t&&void 0!==t&&t.isStart?null:Object(a.jsx)(o.a,{onClick:()=>{r((e=>({...e,isStart:!0})))},color:"primary",fill:"outline",children:"\u5f00\u59cb\u5f55\u5236"}),null!==t&&void 0!==t&&t.isStart?Object(a.jsxs)(o.b,{block:!0,direction:"horizontal",justify:"around",children:[Object(a.jsx)(o.a,{onClick:()=>{v()},color:"danger",children:"\u505c\u6b62\u5e76\u4fdd\u5b58"}),null!==t&&void 0!==t&&t.isPause?Object(a.jsx)(o.a,{onClick:()=>{var e;null===c||void 0===c||c.current.forEach((e=>{var t;(null===e||void 0===e?void 0:e.recorder)&&(null===e||void 0===e||null===(t=e.recorder)||void 0===t||t.resume())})),null===s||void 0===s||null===(e=s.current)||void 0===e||e.resume(),r((e=>({...e,isPause:!1})))},color:"primary",fill:"outline",children:"\u7ee7\u7eed"}):Object(a.jsx)(o.a,{onClick:()=>{var e;null===c||void 0===c||c.current.forEach((e=>{var t;(null===e||void 0===e?void 0:e.recorder)&&(null===e||void 0===e||null===(t=e.recorder)||void 0===t||t.pause())})),null===s||void 0===s||null===(e=s.current)||void 0===e||e.pause(),r((e=>({...e,isPause:!0})))},color:"warning",children:"\u6682\u505c"})]}):null]})})}r(148);class v{constructor(e,t){this.constraints={audio:!0,video:!0},this.stream=void 0,this.videoRef=void 0,this.constraints=null!==e&&void 0!==e?e:this.constraints,this.stream=null,this.videoRef=t}setVideoRef(e){this.videoRef=e}async getMedia(){this.stream=await navigator.mediaDevices.getUserMedia(this.constraints).catch((e=>{throw console.error(e),e})),this.displayInHtml()}getStream(){return this.stream}async startCamera(){await this.getMedia()}async startScreen(){this.stream=await navigator.mediaDevices.getDisplayMedia(this.constraints).catch((e=>{throw console.error(e),e})),this.displayInHtml()}displayInHtml(){var e;null!==(e=this.videoRef)&&void 0!==e&&e.current&&(this.videoRef.current.srcObject=this.stream)}takeSnap(e){if(!this.stream)return;new ImageCapture(this.stream.getVideoTracks()[0]).grabFrame().then((t=>{const r=e.current;if(null!==r){const e=r.getContext("2d");let i,n;{const{width:e,height:t}=getComputedStyle(r);i=Number(e.split("px")[0]),n=Number(t.split("px")[0])}e&&e.clearRect(0,0,i,n),e&&e.drawImage(t,0,0,i,n)}}))}changeDevices(e){this.close(),this.constraints=e,this.getMedia()}close(){var e;console.log(this.stream),null===(e=this.stream)||void 0===e||e.getTracks().forEach((e=>{var t;e.stop(),null===(t=this.stream)||void 0===t||t.removeTrack(e),console.log(`remove ${e.kind}`)}))}}function h(){const e=Object(i.useRef)(null),[t,r]=(Object(i.useRef)(null),Object(i.useState)(!1)),[n]=Object(i.useState)(new v({audio:!0,video:!0},e)),[s,c]=Object(i.useState)(n.getStream());return Object(a.jsxs)("div",{style:{padding:t?0:20},children:[Object(a.jsx)("section",{children:t?Object(a.jsx)("video",{className:"myvideo",src:"#",autoPlay:!0,ref:e}):Object(a.jsxs)("section",{children:[Object(a.jsx)("h4",{children:"\u8fd0\u52a8\u76f8\u673av1.0\u7248 \u4f7f\u7528\u8bf4\u660e\uff1a"}),Object(a.jsxs)(o.b,{direction:"vertical",children:[Object(a.jsx)("p",{children:"1\u3001\u6211\u4eec\u9ad8\u5ea6\u5c0a\u91cd\u7528\u6237\u9690\u79c1\uff0c\u6240\u6709\u6570\u636e\u5747\u4fdd\u5b58\u5728\u7528\u6237\u624b\u673a\u4e0a\uff0c\u5e73\u53f0\u4e0d\u4f1a\u91c7\u96c6\u7528\u6237\u4fe1\u606f"}),Object(a.jsx)("p",{children:"2\u3001\u76f8\u673a\u4f1a\u91c7\u7528\u8fd0\u52a8\u76f8\u673a\u7684\u6a21\u5f0f\uff0c\u5f53\u4f60\u70b9\u51fb\u62cd\u6444\u4e4b\u540e\uff0c\u4f1a\u9884\u5f55\u5236\u70b9\u51fb\u62cd\u6444\u524d\u4e00\u6bb5\u65f6\u95f4\u7684\u89c6\u9891"}),Object(a.jsx)("p",{children:"3\u3001\u4e3a\u4e86\u4fdd\u8bc1\u6027\u80fd\uff0c\u5f53\u524d\u6700\u957f\u652f\u6301\u9884\u5f5515\u79d2\u7684\u89c6\u9891\uff08\u540e\u7eed\u4f1a\u6839\u636e\u7528\u6237\u53cd\u9988\u8fdb\u884c\u6269\u5c55\uff09"}),Object(a.jsx)("p",{children:"4\u3001\u70b9\u51fb\u505c\u6b62\u62cd\u6444\u4f1a\u63d0\u4f9b\u5f55\u5236\u89c6\u9891\u7684\u4e0b\u8f7d\uff0c\u8be5\u8fc7\u7a0b\u4e0d\u4f1a\u4ea7\u751f\u6d41\u91cf\u6d88\u8017\uff0c\u5f55\u5236\u5b8c\u8bf7\u53ca\u65f6\u4fdd\u5b58\uff0c\u907f\u514d\u6570\u636e\u4e22\u5931"})]})]})}),Object(a.jsx)("div",{className:"footer",children:t?null:Object(a.jsx)(o.a,{onClick:()=>{r(!0),async function(e){switch(e){case"camera":await n.startCamera();break;case"screen":await n.startScreen()}c(n.getStream())}("camera")},block:!0,color:"primary",size:"large",children:"\u6211\u77e5\u9053\u4e86"})}),null!==s&&Object(a.jsx)(u,{stream:s})]})}var j=function(){return Object(a.jsx)("div",{className:"App",children:Object(a.jsx)(h,{})})};var m=e=>{e&&e instanceof Function&&r.e(3).then(r.bind(null,150)).then((({getCLS:t,getFID:r,getFCP:i,getLCP:n,getTTFB:s})=>{t(e),r(e),i(e),n(e),s(e)}))};c.a.render(Object(a.jsx)(n.a.StrictMode,{children:Object(a.jsx)(j,{})}),document.getElementById("root")),m()}},[[149,1,2]]]);
//# sourceMappingURL=main.1adb4572.chunk.js.map